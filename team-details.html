<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles del Equipo - Desastre Squad</title>
    <link href="styles.css" rel="stylesheet">
    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-black/20 backdrop-blur-sm border-r border-white/10 flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-white">Desastre Squad</h1>
                        <p class="text-xs text-gray-400">Age of Empires II</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-6 space-y-6">
                <div class="space-y-2">
                    <div class="flex items-center justify-between text-gray-400 text-sm font-medium">
                        <span>RANKINGS</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <a href="ladder.html" class="flex items-center gap-3 px-3 py-2 text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            <span>ELO Leaderboard</span>
                        </a>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex items-center justify-between text-gray-400 text-sm font-medium">
                        <span>STATS</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <a href="players.html" class="flex items-center gap-3 px-3 py-2 text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <span>Player Stats</span>
                        </a>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex items-center justify-between text-gray-400 text-sm font-medium">
                        <span>COMPETITION</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <a href="tournaments.html" class="flex items-center gap-3 px-3 py-2 text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <span>Torneos</span>
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Status -->
            <div class="mt-8 p-4 bg-white/5 rounded-lg border border-white/10">
                <div class="text-center">
                    <div class="text-2xl font-bold text-white mb-1">24</div>
                    <div class="text-xs text-gray-400">Players Online</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <div class="h-16 bg-black/20 backdrop-blur-sm border-b border-white/10 flex items-center justify-between px-6">
                <div class="flex items-center gap-4">
                    <button id="back-btn" class="flex items-center gap-2 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        <span>Volver</span>
                    </button>
                    <h2 class="text-xl font-bold text-white">üèÜ <span id="team-name">Team Details</span></h2>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span>Live Data</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Tournament</div>
                        <div id="tournament-name" class="text-sm font-medium text-white">--</div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="flex-1 p-6 overflow-auto">
                <!-- Loading State -->
                <div id="loading-state" class="flex items-center justify-center h-full">
                    <div class="text-center">
                        <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-white shadow rounded-md">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Loading Team Details...
                        </div>
                    </div>
                </div>

                <!-- Team Details Content -->
                <div id="team-details-content" class="hidden">
                    <!-- Team Stats Header -->
                    <div class="mb-6 bg-white/5 rounded-lg p-6 border border-white/10">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="team-elo">--</div>
                                <div class="text-sm text-gray-400">ELO Promedio</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="team-position">--</div>
                                <div class="text-sm text-gray-400">Posici√≥n</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-white mb-2" id="team-status">Activo</div>
                                <div class="text-sm text-gray-400">Estado</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Radar Chart -->
                        <div class="bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">üìä Estad√≠sticas del Equipo</h3>
                            <div class="relative h-80">
                                <canvas id="team-radar-chart"></canvas>
                            </div>
                        </div>

                        <!-- Arabia Minimap -->
                        <div class="bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">üó∫Ô∏è Posiciones en Arabia</h3>
                            <div class="relative">
                                <img src="arabia-minimap.svg" alt="Arabia Minimap" class="w-full h-80 object-cover rounded-lg" onerror="this.src='arabia-minimap.svg'">
                                <!-- Player positions will be added here -->
                                <div id="player-positions" class="absolute inset-0 pointer-events-none"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Players Grid -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-white mb-4">üë• Jugadores del Equipo</h3>
                        <div id="players-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Player cards will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let teamData = null;
        let tournamentData = null;
        let radarChart = null;

        // Player User IDs mapping
        const playerUserIds = {
            'sszafranko': '2505639',
            'Lugut': '342673',
            'SoLid': '2620848',
            'Jonny': '78611',
            'RELP': '12369433',
            'Reymon': '2212194',
            'Danny': '2446863',
            'Ze Peque√±o': '4183283',
            'Lauritop': '1339133',
            'Herno': '4818662',
            'Eze': '624633',
            'Anakin': '2895394',
            'Chetti': '2663132',
            'TheRazor': '5013587',
            'Pepe': '5400853',
            'Fran Camet': '2809718',
            'Nachorga': '2050506',
            'Marco Van Basten': '227170',
            'Nasper': '228679',
            'Alejo Camet': '2648565',
            'War Machine': '3174913',
            'Dylan': '3582825',
            'Patocuesta': '1100546',
            'ThePipi': '2408832',
            'Nomadplayer': 'placeholder',
            'Joanel': 'placeholder'
        };

        // Get player photo filename
        function getPlayerPhoto(playerName) {
            console.log('Getting photo for player:', playerName);
            
            const photoMap = {
                'sszafranko': 'sszafranko.png',
                'Lugut': 'placeholder-avatar.png',
                'SoLid': 'solid.jpeg',
                'Jonny': 'jonny.jpeg',
                'RELP': 'relp.png',
                'Reymon': 'reymon.png',
                'Danny': 'placeholder-avatar.png',
                'Ze Peque√±o': 'ze peque√±o.png',
                'Lauritop': 'lauritop.png',
                'Herno': 'herno.png',
                'Eze': 'placeholder-avatar.png',
                'Anakin': 'anakin.png',
                'Chetti': 'chetti.png',
                'TheRazor': 'therazor.png',
                'Pepe': 'pepe.png',
                'Fran Camet': 'fran camet.png',
                'Nachorga': 'nachorga.png',
                'Marco Van Basten': 'marco van basten.png',
                'Nasper': 'nasper.png',
                'Alejo Camet': 'alejo camet.png',
                'War Machine': 'placeholder-avatar.png',
                'Dylan': 'dylan.jpeg',
                'Patocuesta': 'patocuesta.png',
                'ThePipi': 'thepipi.png',
                'Nomadplayer': 'placeholder-avatar.png',
                'Joanel': 'placeholder-avatar.png'
            };
            
            const photo = photoMap[playerName];
            console.log('Found photo for', playerName, ':', photo);
            
            return photo || 'placeholder-avatar.png';
        }

        // Determine player position based on predefined pocket list
        function determinePlayerPosition(players) {
            // List of pocket players
            const pocketPlayers = [
                'nomadplayer',
                'fran camet',
                'nasper',
                'alejo camet',
                'chetti',
                'danny',
                'eze',
                'pepe'
            ];
            
            // Assign positions based on the pocket list
            return players.map(player => {
                const isPocket = pocketPlayers.includes(player.name.toLowerCase());
                return {
                    ...player,
                    position: isPocket ? 'pocket' : 'flank'
                };
            });
        }

        // Calculate team average ELO
        function calculateTeamElo(players) {
            const validElos = players
                .map(p => parseInt(p.elo))
                .filter(elo => !isNaN(elo) && elo > 0);
            
            if (validElos.length === 0) return 0;
            return Math.round(validElos.reduce((sum, elo) => sum + elo, 0) / validElos.length);
        }

        // Load player ELOs from Supabase and stats from player data
        async function loadPlayerElos(players) {
            console.log('Loading ELOs and stats for players:', players);
            
            try {
                // Load player data from desastre-squad-players.json
                const response = await fetch('desastre-squad-players.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const playerData = await response.json();
                
                // Create a map of player names to their data
                const playerMap = {};
                playerData.players.forEach(player => {
                    playerMap[player.name.toLowerCase()] = player;
                });
                
                console.log('Player map:', playerMap);
                
                const playersWithData = [];
                
                for (const player of players) {
                    try {
                        console.log(`Loading ELO for player: ${player.name}`);
                        
                        // Get player stats from the map
                        const playerInfo = playerMap[player.name.toLowerCase()];
                        const stats = playerInfo ? playerInfo.stats : {
                            micro: 0,
                            balance: 0,
                            agresividad: 0,
                            adaptabilidad: 0,
                            estrategia: 0,
                            equipo: 0,
                            mentalidad: 0,
                            mapas: 0
                        };
                        
                        console.log(`Stats for ${player.name}:`, stats);
                        
                        // Load ELO from Supabase
                        const eloResponse = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/aoe_elos_1v1?player_name=eq.${encodeURIComponent(player.name)}&select=elo_value,last_updated&order=last_updated.desc&limit=1`, {
                            headers: {
                                'apikey': SUPABASE_CONFIG.key,
                                'Authorization': `Bearer ${SUPABASE_CONFIG.key}`
                            }
                        });
                        
                        console.log(`Response status for ${player.name}:`, eloResponse.status);
                        
                        let elo = 'N/A';
                        if (eloResponse.ok) {
                            const data = await eloResponse.json();
                            console.log(`ELO data for ${player.name}:`, data);
                            if (data.length > 0) {
                                elo = data[0].elo_value;
                            }
                        } else {
                            console.log(`HTTP error for ${player.name}:`, eloResponse.status);
                        }
                        
                        playersWithData.push({
                            ...player,
                            elo: elo,
                            stats: stats
                        });
                        
                    } catch (error) {
                        console.error(`Error loading data for ${player.name}:`, error);
                        playersWithData.push({
                            ...player,
                            elo: 'N/A',
                            stats: {
                                micro: 0,
                                balance: 0,
                                agresividad: 0,
                                adaptabilidad: 0,
                                estrategia: 0,
                                equipo: 0,
                                mentalidad: 0,
                                mapas: 0
                            }
                        });
                    }
                }
                
                console.log('Final players with data:', playersWithData);
                return playersWithData;
                
            } catch (error) {
                console.error('Error loading player data:', error);
                // Return players with default stats
                return players.map(player => ({
                    ...player,
                    elo: 'N/A',
                    stats: {
                        micro: 0,
                        balance: 0,
                        agresividad: 0,
                        adaptabilidad: 0,
                        estrategia: 0,
                        equipo: 0,
                        mentalidad: 0,
                        mapas: 0
                    }
                }));
            }
        }

        // Create radar chart
        function createRadarChart(players) {
            const ctx = document.getElementById('team-radar-chart');
            if (!ctx) return;

            // Destroy existing chart
            if (radarChart) {
                radarChart.destroy();
            }

            // Calculate average stats from player data
            const avgStats = {
                micro: 0,
                balance: 0,
                agresividad: 0,
                adaptabilidad: 0,
                estrategia: 0,
                equipo: 0,
                mentalidad: 0,
                mapas: 0
            };

            // Sum up all player stats
            players.forEach(player => {
                if (player.stats) {
                    avgStats.micro += player.stats.micro || 0;
                    avgStats.balance += player.stats.balance || 0;
                    avgStats.agresividad += player.stats.agresividad || 0;
                    avgStats.adaptabilidad += player.stats.adaptabilidad || 0;
                    avgStats.estrategia += player.stats.estrategia || 0;
                    avgStats.equipo += player.stats.equipo || 0;
                    avgStats.mentalidad += player.stats.mentalidad || 0;
                    avgStats.mapas += player.stats.mapas || 0;
                }
            });

            // Calculate averages
            const playerCount = players.length;
            Object.keys(avgStats).forEach(key => {
                avgStats[key] = avgStats[key] / playerCount;
            });

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Micro', 'Balance', 'Agresividad', 'Adaptabilidad', 'Estrategia', 'Equipo', 'Mentalidad', 'Mapas'],
                    datasets: [{
                        label: 'Equipo',
                        data: [
                            avgStats.micro,
                            avgStats.balance,
                            avgStats.agresividad,
                            avgStats.adaptabilidad,
                            avgStats.estrategia,
                            avgStats.equipo,
                            avgStats.mentalidad,
                            avgStats.mapas
                        ],
                        backgroundColor: 'rgba(147, 51, 234, 0.2)',
                        borderColor: 'rgba(147, 51, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(147, 51, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(147, 51, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2,
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Display player positions on minimap
        function displayPlayerPositions(players) {
            const positionsContainer = document.getElementById('player-positions');
            console.log('Positions container found:', positionsContainer);
            if (!positionsContainer) {
                console.error('Player positions container not found!');
                return;
            }

            positionsContainer.innerHTML = '';

            let flankCount = 0; // Counter for flanks

            players.forEach((player, index) => {
                console.log(`Displaying player ${index}:`, player.name, 'position:', player.position);
                const position = player.position;
                let top, left;

                // Position players on the minimap based on their role
                switch (position) {
                    case 'pocket':
                        // Pocket position - slightly back from center
                        top = '45%';
                        left = '50%';
                        break;
                    case 'flank':
                        // Flank positions - same height, left and right
                        if (flankCount === 0) {
                            // First flank - left side
                            top = '40%';
                            left = '30%';
                            flankCount++;
                        } else {
                            // Second flank - right side
                            top = '40%';
                            left = '70%';
                            flankCount++;
                        }
                        break;
                    default:
                        // Fallback positions
                        top = `${30 + index * 20}%`;
                        left = `${25 + index * 25}%`;
                }

                const playerElement = document.createElement('div');
                playerElement.className = 'absolute transform -translate-x-1/2 -translate-y-1/2';
                playerElement.style.top = top;
                playerElement.style.left = left;

                const photo = getPlayerPhoto(player.name);
                console.log(`Loading photo for ${player.name}: photos/${photo}`);
                playerElement.innerHTML = `
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-white shadow-lg">
                            <img src="photos/${photo}" alt="${player.name}" class="w-full h-full object-cover" onerror="this.src='placeholder-avatar.png'" onload="console.log('Image loaded successfully:', '${player.name}', 'photos/${photo}')" onerror="console.log('Image failed to load:', '${player.name}', 'photos/${photo}')">
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-purple-600 rounded-full flex items-center justify-center text-xs font-bold text-white">
                            ${position === 'pocket' ? 'P' : position === 'flank' ? 'F' : '?'}
                        </div>
                        <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap">
                            ${player.name}
                        </div>
                    </div>
                `;

                positionsContainer.appendChild(playerElement);
                console.log(`Added player element for ${player.name} at position ${position} (${top}, ${left})`);
            });
        }

        // Display players grid
        function displayPlayersGrid(players) {
            const playersGrid = document.getElementById('players-grid');
            if (!playersGrid) return;

            const playerCards = players.map((player, index) => {
                const photo = getPlayerPhoto(player.name);
                const positionColor = player.position === 'pocket' ? 'yellow' : player.position === 'flank' ? 'blue' : 'gray';
                const positionText = player.position === 'pocket' ? 'Pocket' : player.position === 'flank' ? 'Flank' : 'Unknown';
                
                return `
                    <div class="bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 overflow-hidden hover:scale-105 transition-all duration-300">
                        <div class="p-4">
                            <!-- Player Header -->
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-${positionColor}-500/50">
                                    <img src="photos/${photo}" alt="${player.name}" class="w-full h-full object-cover" onerror="this.src='placeholder-avatar.png'">
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-base font-bold text-white">${player.name}</h3>
                                    <p class="text-xs text-gray-400">${positionText}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400">ELO</div>
                                    <div class="text-sm font-medium text-white">${player.elo}</div>
                                </div>
                            </div>
                            
                            <!-- Player Stats -->
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">Posici√≥n:</span>
                                    <span class="text-${positionColor}-400 font-medium">${positionText}</span>
                                </div>
                                <div class="flex justify-between text-xs">
                                    <span class="text-gray-400">ELO:</span>
                                    <span class="text-white font-medium">${player.elo}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            playersGrid.innerHTML = playerCards;
        }

        // Load team details
        async function loadTeamDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const tournamentId = urlParams.get('tournament');
            const teamId = urlParams.get('team');

            console.log('Loading team details with params:', { tournamentId, teamId });

            if (!tournamentId || !teamId) {
                console.error('Missing tournament or team ID');
                return;
            }

            try {
                // Load tournament data
                console.log('Fetching tournament data from: tournament-3v3.json');
                const tournamentResponse = await fetch(`tournament-3v3.json`);
                
                if (!tournamentResponse.ok) {
                    throw new Error(`HTTP error! status: ${tournamentResponse.status}`);
                }
                
                const tournamentData = await tournamentResponse.json();
                console.log('Tournament data loaded:', tournamentData);
                
                // Find the team
                const team = tournamentData.tournament.teams.find(t => t.id == teamId);
                console.log('Looking for team ID:', teamId, 'Found team:', team);
                
                if (!team) {
                    console.error('Team not found');
                    return;
                }

                // Load player ELOs
                const players = [
                    { name: team.captain, role: 'captain' },
                    { name: team.player2, role: 'player2' },
                    { name: team.player3, role: 'player3' }
                ];

                console.log('Loading ELOs for players:', players);
                const playersWithElos = await loadPlayerElos(players);
                console.log('Players with ELOs:', playersWithElos);
                
                const playersWithPositions = determinePlayerPosition(playersWithElos);
                console.log('Players with positions:', playersWithPositions);

                // Update UI
                console.log('Updating UI elements...');
                document.getElementById('team-name').textContent = `Team ${team.id}`;
                document.getElementById('tournament-name').textContent = tournamentData.tournament.name;
                document.getElementById('team-elo').textContent = calculateTeamElo(playersWithPositions);
                document.getElementById('team-position').textContent = `#${team.id}`;

                console.log('Creating radar chart...');
                // Create radar chart
                createRadarChart(playersWithPositions);

                console.log('Displaying player positions...');
                // Display player positions on minimap
                displayPlayerPositions(playersWithPositions);

                console.log('Displaying players grid...');
                // Display players grid
                displayPlayersGrid(playersWithPositions);

                console.log('Showing content...');
                // Show content
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('team-details-content').classList.remove('hidden');

            } catch (error) {
                console.error('Error loading team details:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack
                });
                
                // Show error state
                const loadingState = document.getElementById('loading-state');
                if (loadingState) {
                    loadingState.innerHTML = `
                        <div class="text-center">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-2">Error al cargar</h3>
                            <p class="text-gray-400 mb-6">No se pudieron cargar los detalles del equipo</p>
                            <button onclick="loadTeamDetails()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Reintentar
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const backBtn = document.getElementById('back-btn');
            
            if (backBtn) {
                backBtn.addEventListener('click', function() {
                    window.history.back();
                });
            }

            loadTeamDetails();
        });
    </script>
</body>
</html> 